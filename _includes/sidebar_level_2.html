{% assign pages_list = site.html_pages | sort:"nav_order" %}
{% for node in pages_list %}
  {% unless node.nav_exclude %}
      {% if node.has_children and page.parent == node.title %}
        {% assign children_list = site.html_pages | sort:"nav_order" %}
          <h4 class="my-3">Topics</h4>
          <ul class="nav navbar-nav flex-md-column flex-row justify-content-between">
            {% for child in children_list %}
              {% if child.parent == node.title and node.title != child.title and child.grand_parent == nil %}
                <li class="nav-item{% if page.url == child.url or page.grand_parent == child.title %} active{% endif %}">
                  {% if page.url == child.url or page.parent == child.title %}
                    {% assign second_level_url = child.url | absolute_url %}
                  {% endif %}
                  <a href="{{ child.url | absolute_url }}" class="nav-link pl-2">{{ child.title }}</a>
                  {% if child.has_grand_children %}
                    {% assign grand_children_list = site.html_pages | sort:"nav_order" %}
                    <ul class="nav navbar-nav flex-md-column flex-row justify-content-between">
                      {% for grand_child in grand_children_list %}
                        {% if grand_child.grand_parent == child.title %}
                          <li class="nav-item{% if page.url == grand_child.url %} active{% endif %}">
                            <a href="{{ grand_child.url | absolute_url }}" class="nav-link pl-2">{{ grand_child.title }}</a>
                          </li>
                        {% endif %}
                      {% endfor %}
                    </ul>
                  {% endif %}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        {% endif %}
      </li>
  {% endunless %}
{% endfor %}
